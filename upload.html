<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>上傳程式碼 - StormIQ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Material+Icons+Outlined&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#81C0EA',
            secondary: '#0242C7',
            action: '#008CE3',
            'action-hover': '#0078C7',
            cyan: '#00B2E3',
            success: '#198754',
            warning: '#FFC107',
            danger: '#DC3545',
            'body-bg': '#F8F9FA',
          },
          fontFamily: {
            sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
          },
          borderRadius: {
            '2xl': '1rem',
            '3xl': '1.25rem',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-body-bg font-sans text-gray-800 flex min-h-screen">

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed left-0 top-0 h-full w-[260px] bg-white border-r border-gray-200 z-40 flex flex-col">
    <!-- Logo -->
    <div class="px-6 py-5 border-b border-gray-100">
      <div class="flex items-center gap-2.5">
        <span class="material-icons-outlined text-action text-2xl">security</span>
        <div>
          <h1 class="text-lg font-bold text-gray-900 leading-tight">StormIQ</h1>
          <p class="text-[11px] text-gray-400 leading-tight">資安掃描平台</p>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 py-4">
      <a href="dashboard.html" class="nav-item">
        <span class="material-icons-outlined text-xl">dashboard</span>
        儀表板
      </a>
      <a href="upload.html" class="nav-item active">
        <span class="material-icons-outlined text-xl">cloud_upload</span>
        上傳程式碼
      </a>
      <a href="history.html" class="nav-item">
        <span class="material-icons-outlined text-xl">history</span>
        掃描紀錄
      </a>
      <a href="profile.html" class="nav-item">
        <span class="material-icons-outlined text-xl">settings</span>
        帳戶設定
      </a>
    </nav>

    <!-- Bottom Section -->
    <div class="border-t border-gray-100 p-4 space-y-3">
      <!-- Points Balance -->
      <div class="flex items-center gap-2 bg-blue-50 rounded-xl px-4 py-2.5">
        <span class="material-icons-outlined text-action text-lg">toll</span>
        <div>
          <p class="text-[11px] text-gray-500 leading-tight">剩餘點數</p>
          <p class="text-lg font-bold text-action leading-tight" id="sidebarPoints">42</p>
        </div>
      </div>
      <!-- User Info -->
      <div class="flex items-center gap-3 px-2">
        <div class="w-8 h-8 rounded-full bg-action/10 flex items-center justify-center flex-shrink-0">
          <span class="text-action font-semibold text-sm">R</span>
        </div>
        <div class="min-w-0 flex-1">
          <p class="text-sm font-medium text-gray-900 truncate">Roger Chang</p>
          <p class="text-[11px] text-gray-400 truncate">毅聲科技</p>
        </div>
      </div>
      <!-- Switch to Admin -->
      <a href="admin-dashboard.html" class="flex items-center gap-2 px-2 py-1.5 text-sm text-gray-400 hover:text-action transition-colors mb-1">
        <span class="material-icons-outlined text-lg">swap_horiz</span>
        切換至管理後台
      </a>
      <!-- Logout -->
      <a href="login.html" class="flex items-center gap-2 px-2 py-1.5 text-sm text-gray-400 hover:text-danger transition-colors">
        <span class="material-icons-outlined text-lg">logout</span>
        登出
      </a>
    </div>
  </aside>

  <!-- Main Content -->
  <div id="main-content" class="ml-[260px] flex-1 flex flex-col min-h-screen">
    <!-- Header -->
    <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-8 sticky top-0 z-30">
      <!-- Breadcrumb -->
      <div class="flex items-center gap-2 text-sm">
        <span class="text-gray-400">首頁</span>
        <span class="text-gray-300">/</span>
        <span class="text-gray-700 font-medium">上傳程式碼</span>
      </div>
      <!-- Right side -->
      <div class="flex items-center gap-4">
        <button class="relative p-2 text-gray-400 hover:text-gray-600 transition-colors" onclick="showToast('暫無新通知', 'info')">
          <span class="material-icons-outlined text-xl">notifications_none</span>
        </button>
        <div class="flex items-center gap-2">
          <div class="w-8 h-8 rounded-full bg-action/10 flex items-center justify-center">
            <span class="text-action font-semibold text-sm">R</span>
          </div>
          <span class="text-sm text-gray-700 font-medium hidden sm:block">Roger Chang</span>
        </div>
      </div>
    </header>

    <!-- Content -->
    <main class="flex-1 p-8">
      <!-- Page Title -->
      <div class="mb-8 reveal">
        <h2 class="text-2xl font-bold text-gray-900">上傳程式碼</h2>
        <p class="text-sm text-gray-500 mt-1">上傳您的原始碼進行安全掃描，每次上傳扣除 1 點。</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left: Upload Form (2 cols) -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Points Display -->
          <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-sm flex items-center justify-between reveal">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl bg-blue-50 flex items-center justify-center">
                <span class="material-icons-outlined text-action">toll</span>
              </div>
              <div>
                <p class="text-sm text-gray-500">目前剩餘點數</p>
                <p class="text-2xl font-bold text-gray-900" id="currentPoints">42</p>
              </div>
            </div>
            <div class="text-right">
              <p class="text-xs text-gray-400">本次上傳預估扣除</p>
              <p class="text-lg font-bold text-action">1 點</p>
            </div>
          </div>

          <!-- Drop Zone -->
          <div class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm reveal">
            <div class="drop-zone p-10 text-center" id="uploadDropZone" onclick="document.getElementById('fileInput').click()">
              <input type="file" id="fileInput" class="hidden" accept=".zip,.tar.gz,.rar" onchange="handleFileSelect(this)">
              <span class="material-icons-outlined text-5xl text-gray-300 mb-4 block">cloud_upload</span>
              <p class="text-base font-medium text-gray-700 mb-1" id="dropZoneText">拖曳檔案至此或點擊上傳</p>
              <p class="text-sm text-gray-400" id="dropZoneSubtext">支援 .zip, .tar.gz, .rar 格式，檔案大小上限 500MB</p>
              <!-- File selected state (hidden by default) -->
              <div id="fileSelectedInfo" class="hidden mt-4 bg-blue-50 rounded-xl p-3 inline-flex items-center gap-3">
                <span class="material-icons-outlined text-action">description</span>
                <div class="text-left">
                  <p class="text-sm font-medium text-gray-900" id="selectedFileName"></p>
                  <p class="text-xs text-gray-500" id="selectedFileSize"></p>
                </div>
                <button onclick="event.stopPropagation(); clearFile()" class="text-gray-400 hover:text-danger transition-colors ml-2">
                  <span class="material-icons-outlined text-lg">close</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Form Fields -->
          <div class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm space-y-5 reveal">
            <!-- Project Name -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1.5">
                專案名稱 <span class="text-danger">*</span>
              </label>
              <input type="text" id="projectName" placeholder="例如：Payment Module v2.1"
                class="w-full px-4 py-2.5 border border-gray-200 rounded-xl text-sm transition-colors">
            </div>

            <!-- Scan Notes -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1.5">
                掃描備註 <span class="text-xs text-gray-400 font-normal">（選填）</span>
              </label>
              <textarea id="scanNotes" rows="3" placeholder="例如：請特別注意 SQL injection 相關漏洞"
                class="w-full px-4 py-2.5 border border-gray-200 rounded-xl text-sm transition-colors resize-none"></textarea>
            </div>

            <!-- Cost info -->
            <div class="flex items-center gap-2 bg-gray-50 rounded-xl px-4 py-3">
              <span class="material-icons-outlined text-gray-400 text-lg">info</span>
              <p class="text-sm text-gray-500">預估扣除：<span class="font-semibold text-gray-700">1 點</span>，上傳後剩餘 <span class="font-semibold text-gray-700">41 點</span></p>
            </div>

            <!-- Submit Button -->
            <button id="uploadBtn" onclick="handleUpload()" class="w-full bg-action hover:bg-action-hover text-white font-medium py-3 rounded-xl transition-colors duration-150 text-sm flex items-center justify-center gap-2">
              <span class="material-icons-outlined text-lg">cloud_upload</span>
              確認上傳
            </button>
          </div>
        </div>

        <!-- Right: Info Panel (1 col) -->
        <div class="space-y-6">
          <!-- Upload Guidelines -->
          <div class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm reveal">
            <div class="flex items-center gap-2 mb-4">
              <span class="material-icons-outlined text-action text-lg">info</span>
              <h3 class="text-base font-semibold text-gray-900">上傳須知</h3>
            </div>
            <ul class="space-y-3">
              <li class="flex items-start gap-2.5">
                <span class="material-icons-outlined text-sm text-action mt-0.5">check_circle</span>
                <p class="text-sm text-gray-600 leading-relaxed">上傳的原始碼將由專業團隊進行安全掃描分析</p>
              </li>
              <li class="flex items-start gap-2.5">
                <span class="material-icons-outlined text-sm text-action mt-0.5">check_circle</span>
                <p class="text-sm text-gray-600 leading-relaxed">掃描結果預計於 <span class="font-medium text-gray-800">24 小時內</span> 完成</p>
              </li>
              <li class="flex items-start gap-2.5">
                <span class="material-icons-outlined text-sm text-action mt-0.5">check_circle</span>
                <p class="text-sm text-gray-600 leading-relaxed">完成後可下載 HTML 或 PDF 格式報告</p>
              </li>
              <li class="flex items-start gap-2.5">
                <span class="material-icons-outlined text-sm text-action mt-0.5">check_circle</span>
                <p class="text-sm text-gray-600 leading-relaxed">每次上傳將自動扣除公司帳戶 <span class="font-medium text-gray-800">1 點</span></p>
              </li>
              <li class="flex items-start gap-2.5">
                <span class="material-icons-outlined text-sm text-action mt-0.5">check_circle</span>
                <p class="text-sm text-gray-600 leading-relaxed">支援格式：.zip, .tar.gz, .rar</p>
              </li>
              <li class="flex items-start gap-2.5">
                <span class="material-icons-outlined text-sm text-action mt-0.5">check_circle</span>
                <p class="text-sm text-gray-600 leading-relaxed">檔案大小上限 500MB</p>
              </li>
            </ul>
          </div>

          <!-- Scan Process -->
          <div class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm reveal">
            <div class="flex items-center gap-2 mb-4">
              <span class="material-icons-outlined text-action text-lg">route</span>
              <h3 class="text-base font-semibold text-gray-900">掃描流程</h3>
            </div>
            <div class="space-y-4">
              <div class="flex items-start gap-3">
                <div class="w-7 h-7 rounded-full bg-action text-white flex items-center justify-center flex-shrink-0 text-xs font-bold">1</div>
                <div>
                  <p class="text-sm font-medium text-gray-800">上傳檔案</p>
                  <p class="text-xs text-gray-400 mt-0.5">選擇檔案並填寫專案資訊</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-7 h-7 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center flex-shrink-0 text-xs font-bold">2</div>
                <div>
                  <p class="text-sm font-medium text-gray-800">系統掃描</p>
                  <p class="text-xs text-gray-400 mt-0.5">自動化安全檢測分析</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-7 h-7 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center flex-shrink-0 text-xs font-bold">3</div>
                <div>
                  <p class="text-sm font-medium text-gray-800">報告產出</p>
                  <p class="text-xs text-gray-400 mt-0.5">掃描完成通知並可下載</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Uploads Quick View -->
          <div class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm reveal">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-sm font-semibold text-gray-900">最近上傳</h3>
              <a href="#" class="text-xs text-action hover:text-action-hover font-medium transition-colors">全部 &rarr;</a>
            </div>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 min-w-0">
                  <span class="material-icons-outlined text-sm text-gray-400">description</span>
                  <span class="text-sm text-gray-700 truncate">payment-module.zip</span>
                </div>
                <span class="badge badge-completed text-[11px]">已完成</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 min-w-0">
                  <span class="material-icons-outlined text-sm text-gray-400">description</span>
                  <span class="text-sm text-gray-700 truncate">auth-service.tar.gz</span>
                </div>
                <span class="badge badge-scanning animate-pulse text-[11px]">掃描中</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 min-w-0">
                  <span class="material-icons-outlined text-sm text-gray-400">description</span>
                  <span class="text-sm text-gray-700 truncate">api-gateway.zip</span>
                </div>
                <span class="badge badge-completed text-[11px]">已完成</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="assets/js/common.js"></script>
  <script>
    let selectedFile = null;

    function handleFileSelect(input) {
      if (input.files && input.files[0]) {
        selectedFile = input.files[0];
        showFileInfo(selectedFile);
      }
    }

    function showFileInfo(file) {
      document.getElementById('fileSelectedInfo').classList.remove('hidden');
      document.getElementById('selectedFileName').textContent = file.name;
      document.getElementById('selectedFileSize').textContent = formatFileSize(file.size);
      document.getElementById('dropZoneText').textContent = '已選擇檔案';
      document.getElementById('dropZoneSubtext').textContent = '點擊可重新選擇';
    }

    function clearFile() {
      selectedFile = null;
      document.getElementById('fileInput').value = '';
      document.getElementById('fileSelectedInfo').classList.add('hidden');
      document.getElementById('dropZoneText').textContent = '拖曳檔案至此或點擊上傳';
      document.getElementById('dropZoneSubtext').textContent = '支援 .zip, .tar.gz, .rar 格式，檔案大小上限 500MB';
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / 1048576).toFixed(1) + ' MB';
    }

    function handleUpload() {
      const projectName = document.getElementById('projectName').value.trim();
      if (!projectName) {
        showToast('請輸入專案名稱', 'warning');
        document.getElementById('projectName').focus();
        return;
      }

      const btn = document.getElementById('uploadBtn');
      setButtonLoading(btn, true);

      // Simulate upload progress
      setTimeout(() => {
        setButtonLoading(btn, false);
        showToast('上傳成功！扣除 1 點，剩餘 41 點', 'success');

        // Update points display
        document.getElementById('currentPoints').textContent = '41';
        document.getElementById('sidebarPoints').textContent = '41';

        // Redirect after showing toast
        setTimeout(() => {
          // In real app: window.location.href = 'history.html';
          showToast('正在前往掃描紀錄頁面...', 'info');
        }, 1500);
      }, 2000);
    }

    // Enhanced drag-drop for the upload zone
    const dropZone = document.getElementById('uploadDropZone');
    if (dropZone) {
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dragover');
      });
      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragover');
      });
      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        if (e.dataTransfer.files && e.dataTransfer.files[0]) {
          selectedFile = e.dataTransfer.files[0];
          showFileInfo(selectedFile);
        }
      });
    }
  </script>
</body>
</html>
